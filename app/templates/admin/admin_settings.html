{% extends 'admin/admin_base.html' %}

{% block title %}Configuraciones - Admin{% endblock %}

{% block content %}
  <div class="row g-3">
    {# Mantengo un único form que engloba ambas cards para no cambiar la lógica del servidor #}
    <div class="row g-3">
      <div class="col-12 col-md-8">
        <form method="POST" action="{{ url_for('admin.admin_settings_site') }}">
          {%- if form is defined and form.csrf_token is defined -%}
            {{ form.csrf_token }}
          {%- elif csrf_token is defined -%}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          {%- endif -%}
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Nombre del Sitio</h5>
              <p class="small text-muted">{{ system_name }} — Nombre mostrado en cabeceras y correos.</p>

              <div class="mb-3">
                <label for="siteName" class="form-label">Nombre del Sitio</label>
                <input type="text" id="siteName" name="siteName" class="form-control" value="{{ settings.system_name if settings and settings.system_name else 'Mensajería Masiva' }}" required>
                <div class="form-text">Nombre mostrado en cabeceras y correos.</div>
              </div>

              <div class="mb-3">
                <label for="supportEmail" class="form-label">Correo de Soporte</label>
                <input type="email" id="supportEmail" name="supportEmail" class="form-control" value="{{ settings.support_email if settings and settings.support_email else support_email }}">
                <div class="form-text">Correo para notificaciones y recuperaciones.</div>
              </div>

              <div class="row g-3">
                <div class="col-6">
                  <label for="defaultPage" class="form-label">Página por defecto</label>
                  <select id="defaultPage" name="defaultPage" class="form-select">
                    <option value="home" {% if settings and settings.default_page=='home' %}selected{% endif %}>Home</option>
                    <option value="grupos" {% if settings and settings.default_page=='grupos' %}selected{% endif %}>Grupos</option>
                    <option value="notificaciones" {% if settings and settings.default_page=='notificaciones' %}selected{% endif %}>Notificaciones</option>
                  </select>
                </div>
                <div class="col-6">
                  <label for="maxConcurrent" class="form-label">Máx. envíos simultáneos</label>
                  <input id="maxConcurrent" name="maxConcurrent" type="number" min="1" class="form-control" value="{{ settings.max_concurrent if settings and settings.max_concurrent else 5 }}">
                  <div class="form-text">Controla la concurrencia en envíos masivos.</div>
                </div>
              </div>
            </div>
            <div class="card-footer text-end">
              <button type="submit" class="btn btn-primary">Guardar ajustes del sitio</button>
            </div>
          </div>
        </form>
      </div>

      <div class="col-12 col-md-4">
        <form method="POST" action="{{ url_for('admin.admin_settings_maintenance') }}">
          {%- if form is defined and form.csrf_token is defined -%}
            {{ form.csrf_token }}
          {%- elif csrf_token is defined -%}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          {%- endif -%}
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Modo mantenimiento</h5>
              <p class="small text-muted">Activa o desactiva el modo mantenimiento y configura el mensaje que verán los usuarios.</p>

              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="maintenanceSwitch" name="maintenance" {% if settings and settings.maintenance %}checked{% endif %}>
                <label class="form-check-label" for="maintenanceSwitch">Activado</label>
              </div>

              <div class="mb-3">
                <label for="maintenanceMessage" class="form-label">Mensaje de mantenimiento</label>
                <textarea id="maintenanceMessage" name="maintenanceMessage" class="form-control" rows="6">{{ settings.maintenance_message if settings and settings.maintenance_message else '' }}</textarea>
                <div class="form-text">Texto mostrado a usuarios cuando el sistema esté en mantenimiento.</div>
              </div>
            </div>
            <div class="card-footer text-end">
              <button type="submit" class="btn btn-primary">Guardar mantenimiento</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
